<!DOCTYPE html>
<html lang="en" id="html" class="scroll-auto scrollbar-hide dark">
  <head>
    <title>Yumi-Proxy</title>
    <!-- ========== Basic Meta Tags ========== -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="icon"
      type="image/x-icon"
      href="https://github.com/user-attachments/assets/b5feabb7-3f20-4028-9436-e3f3307dd2ae"
    />
    <meta
      name="description"
      content="hello ðŸ‘‹ my name is Ahmad Wandi, I am a student at Antasari Banjarmasin State Islamic University, I really like machine learning"
    />
    <meta
      name="keywords"
      content="mayumiwandi, website, proxy, VPN, mayumi wandi, yumi, yui, mayumiyui"
    />
    <meta name="author" content="mayumiwandi" />
    <meta name="copyright" content="Â© 2025 Yumi" />

    <!-- ========== Open Graph / Facebook ========== -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Yumi - Profile" />
    <meta
      property="og:description"
      content="hello, my name is Ahmad Wandi, I am a student at Antasari Banjarmasin State Islamic University, I really like machine learning"
    />
    <meta property="og:url" content="https://mayumiwandi.github.io/" />
    <meta property="og:site_name" content="Yumi - Profile" />
    <meta
      property="og:image"
      content="https://github.com/user-attachments/assets/b5feabb7-3f20-4028-9436-e3f3307dd2ae"
    />
    <meta property="og:locale" content="id_ID" />

    <!-- ========== Twitter Cards ========== -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Yumi - Profile" />
    <meta
      name="twitter:description"
      content="hello, my name is Ahmad Wandi, I am a student at Antasari Banjarmasin State Islamic University, I really like machine learning"
    />
    <meta
      name="twitter:image"
      content="https://github.com/user-attachments/assets/b5feabb7-3f20-4028-9436-e3f3307dd2ae"
    />
    <meta name="twitter:site" content="@mayumiwandi" />
    <meta name="twitter:creator" content="@mayumiwandi" />

    <!-- ========== SEO & Lokasi ========== -->
    <link rel="canonical" href="https://mayumiwandi.github.io/" />
    <meta name="robots" content="index, follow" />
    <meta name="geo.region" content="ID" />
    <meta name="geo.placename" content="Indonesia" />

    <!-- ========== Mobile & App Tags ========== -->
    <meta name="theme-color" content="#ffffff" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />

    <!-- ========== Tailwindcss & style css ========== -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* For Webkit-based browsers (Chrome, Safari and Opera) */
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }

      /* For IE, Edge and Firefox */
      .scrollbar-hide {
        -ms-overflow-style: none;
        /* IE and Edge */
        scrollbar-width: none;
        /* Firefox */
      }

      @keyframes rainbow-text {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .animate-rainbow {
        background: linear-gradient(
          150deg,
          #ffc0cb,
          #ffa07a,
          #98fb98,
          #87cefa,
          #d8bfd8,
          #ffc0cb
        );
        background-size: 300% auto;
        color: transparent;
        -webkit-background-clip: text;
        background-clip: text;
        animation: rainbow-text 10s linear infinite;
      }
    </style>
    <script>
      tailwind.config = {
        darkMode: "selector",
        theme: {
          extend: {
            fontSize: {
              "3xl": "1.875rem", // Menambahkan ukuran 30px
            },
          },
        },
      };
    </script>
  </head>

  <body
    class="bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-white bg-fixed transition-colors duration-300"
  >
    <!-- PENAMBAHAN: Layar Pemuatan (Loading Screen) -->
    <div
      id="loading-screen"
      class="fixed inset-0 z-50 flex justify-center items-center bg-gray-900 bg-opacity-80 transition-opacity duration-500"
    >
      <div
        class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-400"
      ></div>
    </div>

    <!-- Notification -->
    <div
      id="notification-badge"
      class="fixed z-50 opacity-0 transition-opacity ease-in-out duration-300 mt-9 mr-6 right-0 p-3 max-w-sm bg-white dark:bg-gray-800 rounded-xl border-2 border-gray-300 dark:border-gray-700 flex items-center gap-x-4"
    >
      <div class="shrink-0">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="currentColor"
          class="size-6 text-gray-800 dark:text-gray-200"
        >
          <path
            d="M5.85 3.5a.75.75 0 0 0-1.117-1 9.719 9.719 0 0 0-2.348 4.876.75.75 0 0 0 1.479.248A8.219 8.219 0 0 1 5.85 3.5ZM19.267 2.5a.75.75 0 1 0-1.118 1 8.22 8.22 0 0 1 1.987 4.124.75.75 0 0 0 1.48-.248A9.72 9.72 0 0 0 19.266 2.5Z"
          />
          <path
            fill-rule="evenodd"
            d="M12 2.25A6.75 6.75 0 0 0 5.25 9v.75a8.217 8.217 0 0 1-2.119 5.52.75.75 0 0 0 .298 1.206c1.544.57 3.16.99 4.831 1.243a3.75 3.75 0 1 0 7.48 0 24.583 24.583 0 0 0 4.83-1.244.75.75 0 0 0 .298-1.205 8.217 8.217 0 0 1-2.118-5.52V9A6.75 6.75 0 0 0 12 2.25ZM9.75 18c0-.034 0-.067.002-.1a25.05 25.05 0 0 0 4.496 0l.002.1a2.25 2.25 0 1 1-4.5 0Z"
            clip-rule="evenodd"
          />
        </svg>
      </div>
      <div>
        <div id="notification-title" class="text-md font-bold text-blue-500">
          Berhasil!
        </div>
        <p
          id="notification-message"
          class="text-sm text-gray-700 dark:text-gray-300"
        >
          Akun berhasil disalin
        </p>
      </div>
    </div>
    <!-- Wildcards Window -->
    <div
      id="wildcards-window"
      class="fixed hidden z-40 inset-0 bg-gray-900 bg-opacity-75 flex justify-center items-center p-4"
    >
      <div
        class="w-full max-w-md h-auto flex flex-col gap-4 p-4 bg-gray-800 border border-gray-700 rounded-lg"
      >
        <h3 class="text-xl font-bold text-white">Manage Wildcard Domains</h3>
        <div class="flex w-full h-full gap-2 justify-between">
          <input
            id="new-domain-input"
            type="text"
            placeholder="your-subdomain"
            class="w-full h-full px-4 py-2 rounded-md focus:outline-0 bg-gray-700 text-white"
          />
          <span
            id="root-domain-text"
            class="flex items-center text-gray-400 text-sm md:text-base"
            >.example.com</span
          >
          <button
            onclick="registerDomain()"
            class="p-2 rounded-full bg-blue-600 hover:bg-blue-700 flex justify-center items-center"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="size-6"
            >
              <path
                d="M12 4.5a.75.75 0 0 1 .75.75v6h6a.75.75 0 0 1 0 1.5h-6v6a.75.75 0 0 1-1.5 0v-6h-6a.75.75 0 0 1 0-1.5h6v-6A.75.75 0 0 1 12 4.5Z"
              />
            </svg>
          </button>
        </div>
        <div
          id="container-domains"
          class="w-full h-48 rounded-md flex flex-col gap-1 overflow-y-scroll scrollbar-hide p-2 bg-gray-900"
        >
          <!-- Domain list will be populated here -->
          <div
            class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"
          ></div>
        </div>
        <button
          onclick="toggleWildcardsWindow()"
          class="w-full border-2 border-indigo-500 hover:bg-indigo-500 text-white p-2 rounded-full flex justify-center items-center"
        >
          Close
        </button>
      </div>
    </div>

    <!-- PERUBAHAN: Jendela Pilihan Format Output Ditambahkan -->
    <div
      id="output-window"
      class="fixed hidden z-40 inset-0 bg-gray-900 bg-opacity-75 flex justify-center items-center p-4"
    >
      <div
        class="w-full max-w-sm h-auto flex flex-col gap-4 p-4 text-center rounded-lg bg-gray-800 border border-gray-700"
      >
        <h3 class="text-xl font-bold text-white">Choose Format</h3>
        <div class="grid grid-cols-3 gap-2">
          <button
            onclick="copyToClipboardAsTarget('clash')"
            class="p-2 rounded-lg bg-amber-500 hover:bg-amber-600 flex justify-center items-center"
          >
            Clash
          </button>
          <button
            onclick="copyToClipboardAsTarget('sfa')"
            class="p-2 rounded-lg bg-amber-500 hover:bg-amber-600 flex justify-center items-center"
          >
            SFA
          </button>
          <button
            onclick="copyToClipboardAsTarget('bfr')"
            class="p-2 rounded-lg bg-amber-500 hover:bg-amber-600 flex justify-center items-center"
          >
            BFR
          </button>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <button
            onclick="copyToClipboardAsTarget('v2ray')"
            class="p-2 rounded-lg bg-amber-500 hover:bg-amber-600 flex justify-center items-center"
          >
            V2Ray/Xray
          </button>
          <button
            onclick="copyToClipboardAsRaw()"
            class="p-2 rounded-lg bg-amber-500 hover:bg-amber-600 flex justify-center items-center"
          >
            Raw
          </button>
        </div>
        <div class="flex w-full h-full gap-1 justify-center mt-2">
          <button
            onclick="toggleOutputWindow()"
            class="w-1/2 border-2 border-indigo-500 hover:bg-indigo-500 text-white p-2 rounded-full flex justify-center items-center"
          >
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Select Country Sidebar -->
    <div
      class="h-full fixed top-0 w-14 bg-gray-100 dark:bg-gray-900 border-r-2 border-gray-300 dark:border-gray-700 z-20 overflow-y-scroll scrollbar-hide"
    >
      <div
        id="country-flags-container"
        class="text-2xl flex flex-col items-center h-full gap-2 py-2"
      >
        <!-- Flags will be inserted here by JavaScript -->
        <div
          class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"
        ></div>
      </div>
    </div>

    <!-- Konten utama awalnya disembunyikan -->
    <div
      id="main-container"
      class="ml-14 opacity-0 transition-opacity duration-500"
    >
      <!-- Header -->
      <header
        class="p-4 flex flex-col md:flex-row md:justify-between md:items-center gap-4"
      >
        <h1 class="text-3xl md:text-4xl font-bold text-center md:text-left">
          Welcome to <span class="animate-rainbow">Yumi P</span>
        </h1>
        <div
          class="flex flex-wrap justify-center md:justify-end gap-4 md:gap-6 items-center text-base md:text-xl lg:text-2xl"
        >
          <span class="text-gray-600 dark:text-gray-300"
            >Total Proxy:
            <strong id="total-proxy-value" class="font-semibold"
              >0</strong
            ></span
          >
          <span class="text-gray-600 dark:text-gray-300"
            >Page:
            <strong id="page-info-value" class="font-semibold"
              >0/0</strong
            ></span
          >
          <span class="text-gray-600 dark:text-gray-300"
            >Time:
            <strong id="time-info-value" class="font-semibold"
              >00:00:00</strong
            ></span
          >
          <span class="text-gray-600 dark:text-gray-300"
            >Your IP: <strong id="ip-value">127.0.0.1</strong></span
          >
          <span class="text-gray-600 dark:text-gray-300"
            >ISP: <strong id="isp-value">Localhost</strong></span
          >
        </div>
      </header>

      <!-- Proxy Grid -->
      <main class="px-4 pb-24">
        <div
          id="proxy-grid-container"
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"
        >
          <!-- Proxy cards will be inserted here by JavaScript -->
          <p class="text-center col-span-full">Loading proxy list...</p>
        </div>
      </main>

      <!-- Pagination -->
      <nav
        id="container-pagination"
        class="w-full fixed bottom-0 mb-6 flex justify-center items-center"
      >
        <!-- Pagination buttons will be inserted here -->
      </nav>
    </div>

    <!-- Floating Action Buttons -->
    <footer>
      <div class="fixed bottom-3 right-3 flex flex-col gap-2 z-50">
        <a href="https://trakteer.id/mayumiwandi/tip" target="_blank">
          <button
            class="bg-green-500 hover:bg-green-600 rounded-full border-2 border-gray-900 p-2 block"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="size-6"
            >
              <path
                d="M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 0 1-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.323.152-.691.546-1.004ZM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 0 1-.921.42Z"
              />
              <path
                fill-rule="evenodd"
                d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v.816a3.836 3.836 0 0 0-1.72.756c-.712.566-1.112 1.35-1.112 2.178 0 .829.4 1.612 1.113 2.178.502.4 1.102.647 1.719.756v2.978a2.536 2.536 0 0 1-.921-.421l-.879-.66a.75.75 0 0 0-.9 1.2l.879.66c.533.4 1.169.645 1.821.75V18a.75.75 0 0 0 1.5 0v-.81a4.124 4.124 0 0 0 1.821-.749c.745-.559 1.179-1.344 1.179-2.191 0-.847-.434-1.632-1.179-2.191a4.122 4.122 0 0 0-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75 0 0 0 .933-1.175l-.415-.33a3.836 3.836 0 0 0-1.719-.755V6Z"
                clip-rule="evenodd"
              />
            </svg>
          </button>
        </a>
        <a href="https://t.me/Yumi_Beako" target="_blank">
          <button
            class="bg-sky-500 hover:bg-sky-600 rounded-full border-2 border-gray-900 p-2 block"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="size-6"
            >
              <path
                d="M1.946 9.315c-.522-.174-.527-.455.01-.634l19.087-6.362c.529-.176.832.12.684.638l-5.454 19.086c-.15.529-.455.547-.679.045L12 14l6-8-8 6-8.054-2.685z"
              />
            </svg>
          </button>
        </a>
        <button
          id="wildcard-button"
          onclick="toggleWildcardsWindow()"
          class="bg-indigo-500 hover:bg-indigo-600 rounded-full border-2 border-gray-900 p-2 hidden"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 9V4.5M9 9H4.5M9 9 3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5 5.25 5.25"
            />
          </svg>
        </button>
        <button
          onclick="toggleDarkMode()"
          class="bg-amber-500 hover:bg-amber-600 rounded-full border-2 border-gray-900 p-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"
            />
          </svg>
        </button>
      </div>
    </footer>

    <script>
      const WORKER_URL = "https://celeliaamelia.biz.id"; // Ganti dengan URL worker Anda
      const SERVICE_NAME = "delulu"; // Ganti dengan nama service worker Anda
      const PROXY_PER_PAGE = 8;

      let fullProxyList = [];
      let currentPage = 0;

      async function main() {
        const urlParams = new URLSearchParams(window.location.search);
        const countryCode = urlParams.get("cc");
        const proxyListUrl = urlParams.get("proxy-list");

        currentPage = parseInt(urlParams.get("page") || "0", 10);

        document.getElementById(
          "root-domain-text"
        ).textContent = `.${WORKER_URL.split(".").slice(-3).join(".")}`;

        await Promise.all([
          loadGeoIP(),
          loadProxies(countryCode, proxyListUrl),
          checkApiStatus(),
        ]);

        updateTime();
        setInterval(updateTime, 1000);
      }

      async function checkApiStatus() {
        try {
          const response = await fetch(`${WORKER_URL}/api/v1/status`);
          const data = await response.json();
          if (data.domainApiReady) {
            document
              .getElementById("wildcard-button")
              .classList.remove("hidden");
          }
        } catch (error) {
          console.error("Could not check API status:", error);
        }
      }

      async function loadProxies(countryCode = null, proxyListUrl = null) {
        const gridContainer = document.getElementById("proxy-grid-container");
        try {
          let apiUrl = `${WORKER_URL}/api/v1/proxies`;

          const response = await fetch(apiUrl);
          if (!response.ok)
            throw new Error(`API Error: ${response.statusText}`);

          fullProxyList = await response.json();

          renderCountryFlags(fullProxyList);

          if (countryCode) {
            const filteredList = fullProxyList.filter((p) =>
              countryCode.split(",").includes(p.country)
            );
            renderFilteredProxies(filteredList);
          } else {
            renderFilteredProxies(fullProxyList);
          }
        } catch (error) {
          console.error("Failed to load proxies:", error);
          gridContainer.innerHTML = `<p class="text-center col-span-full text-red-500">Failed to load proxy list. Please check the console.</p>`;
        }
      }

      function renderFilteredProxies(proxyList) {
        const gridContainer = document.getElementById("proxy-grid-container");
        document.getElementById("total-proxy-value").textContent =
          proxyList.length;

        if (proxyList.length === 0) {
          gridContainer.innerHTML =
            '<p class="text-center col-span-full">No proxies found for the selected criteria.</p>';
          renderPagination(0, 0); // Reset pagination
        } else {
          renderPage(currentPage, proxyList);
        }
      }

      function renderPage(page, proxyList) {
        const gridContainer = document.getElementById("proxy-grid-container");
        const startIndex = page * PROXY_PER_PAGE;
        const endIndex = startIndex + PROXY_PER_PAGE;
        const pageProxies = proxyList.slice(startIndex, endIndex);

        gridContainer.innerHTML = "";
        pageProxies.forEach((proxy, index) => {
          const card = createProxyCard(proxy, startIndex + index);
          gridContainer.appendChild(card);
        });

        renderPagination(page, proxyList.length);
        setTimeout(() => checkAllProxiesHealth(), 100);
      }

      function createProxyCard(proxy, globalIndex) {
        const card = document.createElement("div");
        card.className =
          "bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-3 flex flex-col gap-2";

        const configs = generateAllConfigsForProxy(proxy);

        card.innerHTML = `
                <div class="flex justify-between items-center">
                    <div id="ping-${globalIndex}" data-target="${
          proxy.proxyIP
        }:${
          proxy.proxyPort
        }" class="text-xs text-gray-500 dark:text-gray-400">Idle</div>
                    <img width=24 src="https://hatscripts.github.io/circle-flags/flags/${proxy.country.toLowerCase()}.svg" alt="${
          proxy.country
        } flag" />
                </div>
                <h3 class="font-bold text-teal-600 dark:text-teal-400 text-lg -mt-1 truncate">${
                  proxy.org
                }</h3>
                <div class="text-gray-600 dark:text-gray-300 text-sm -mt-2">
                    <p>IP: ${proxy.proxyIP}</p>
                    <p>Port: ${proxy.proxyPort}</p>
                </div>
                <div class="grid grid-cols-2 gap-2 mt-1 text-sm">
                    ${configs
                      .map(
                        (c) =>
                          `<button class="bg-blue-600 hover:bg-blue-700 rounded p-2 w-full text-white" onclick="showFormatSelection('${c.url}')">${c.name}</button>`
                      )
                      .join("")}
                </div>
            `;
        return card;
      }

      function renderPagination(page, totalItems) {
        const paginationContainer = document.getElementById(
          "container-pagination"
        );
        const totalPages = Math.ceil(totalItems / PROXY_PER_PAGE);
        document.getElementById("page-info-value").textContent = `${page + 1}/${
          totalPages > 0 ? totalPages : 1
        }`;

        paginationContainer.innerHTML = "";
        if (totalPages <= 1) return;

        const ul = document.createElement("ul");
        ul.className = "flex justify-center space-x-4";

        const prevDisabled = page === 0;
        ul.innerHTML += `
                <li>
                    <button ${prevDisabled ? "disabled" : ""} 
                            class="px-4 py-2 bg-amber-500 text-gray-900 font-semibold rounded-lg hover:bg-amber-600 disabled:bg-gray-600 disabled:cursor-not-allowed" 
                            onclick="navigateToPage(${page - 1})">
                        Prev
                    </button>
                </li>`;

        const nextDisabled = page >= totalPages - 1;
        ul.innerHTML += `
                <li>
                    <button ${nextDisabled ? "disabled" : ""} 
                            class="px-4 py-2 bg-amber-500 text-gray-900 font-semibold rounded-lg hover:bg-amber-600 disabled:bg-gray-600 disabled:cursor-not-allowed" 
                            onclick="navigateToPage(${page + 1})">
                        Next
                    </button>
                </li>`;

        paginationContainer.appendChild(ul);
      }

      function renderCountryFlags(proxies) {
        const flagsContainer = document.getElementById(
          "country-flags-container"
        );
        const urlParams = new URLSearchParams(window.location.search);
        const selectedCC = urlParams.get("cc");
        const proxyListUrl = urlParams.get("proxy-list");

        const uniqueCountries = [
          ...new Set(proxies.map((p) => p.country)),
        ].sort();

        flagsContainer.innerHTML = "";

        const allLink = createFlagLink("ALL", !selectedCC, proxyListUrl);
        flagsContainer.appendChild(allLink);

        uniqueCountries.forEach((country) => {
          const isSelected = selectedCC === country;
          const link = createFlagLink(country, isSelected, proxyListUrl);
          flagsContainer.appendChild(link);
        });
      }

      function createFlagLink(country, isSelected, proxyListUrl) {
        const link = document.createElement("a");
        const linkParams = new URLSearchParams();
        if (country !== "ALL") linkParams.set("cc", country);
        if (proxyListUrl) linkParams.set("proxy-list", proxyListUrl);

        link.href = `?${linkParams.toString()}`;
        link.className = `flex items-center justify-center ${
          isSelected ? "border-2 border-blue-400 rounded-lg p-0.5" : "py-1"
        }`;

        if (country === "ALL") {
          link.innerHTML = `<div class="w-[30px] h-[30px] flex items-center justify-center text-sm font-bold">${country}</div>`;
        } else {
          link.innerHTML = `<img width=30 src="https://hatscripts.github.io/circle-flags/flags/${country.toLowerCase()}.svg" alt="${country} flag" />`;
        }
        return link;
      }

      // Fungsi Helper & Event Handler
      function navigateToPage(page) {
        const urlParams = new URLSearchParams(window.location.search);
        urlParams.set("page", page);
        window.location.search = urlParams.toString();
      }

      function applyRandomHeaderColors() {
        const colors = [
          "text-purple-400",
          "dark:text-purple-300",
          "text-pink-400",
          "dark:text-pink-300",
          "text-green-500",
          "dark:text-green-400",
          "text-orange-500",
          "dark:text-orange-400",
          "text-teal-500",
          "dark:text-teal-300",
        ];

        const elements = [
          document.getElementById("total-proxy-value"),
          document.getElementById("page-info-value"),
          document.getElementById("time-info-value"),
          document.getElementById("ip-value"),
          document.getElementById("isp-value"),
        ];

        elements.forEach((el) => {
          if (el) {
            el.parentElement.className = el.parentElement.className
              .replace(/text-\w+-\d+/g, "")
              .replace(/dark:text-\w+-\d+/g, "");

            const randomColor =
              colors[Math.floor(Math.random() * colors.length)];
            el.parentElement.classList.add(...randomColor.split(" "));
          }
        });
      }

      function generateAllConfigsForProxy(proxy) {
        const configs = [];
        const uuid = crypto.randomUUID();
        const protocols = ["trojan", "vless", "ss"];
        const ports = [443, 80];

        ports.forEach((port) => {
          protocols.forEach((protocol) => {
            const host = WORKER_URL.replace(/^https?:\/\//, "");
            const uri = new URL(`${protocol}://${host}`);
            uri.port = port;

            uri.searchParams.set("type", "ws");
            uri.searchParams.set("host", host);
            uri.searchParams.set(
              "path",
              `/${proxy.proxyIP}-${proxy.proxyPort}`
            );
            // Logika TLS = SNI
            const isTls = port === 443;
            uri.searchParams.set("security", isTls ? "tls" : "none");

            if (isTls) {
              uri.searchParams.set("sni", host);
            }

            if (protocol === "ss") {
              uri.username = btoa(`none:${uuid}`);
              uri.searchParams.set(
                "plugin",
                `v2ray-plugin;tls=${isTls};mux=0;mode=websocket;path=/${proxy.proxyIP}-${proxy.proxyPort};host=${host}`
              );
            } else {
              uri.username = uuid;
              if (protocol === "vless") {
                uri.searchParams.set("encryption", "none");
              }
            }

            const tls_ntls = isTls ? "TLS" : "NTLS";
            uri.hash = `${proxy.country} ${proxy.org} ${tls_ntls} [${SERVICE_NAME}]`;

            configs.push({
              name: `${protocol.toUpperCase()} ${tls_ntls}`,
              url: uri.toString(),
            });
          });
        });
        return configs;
      }

      // Generate Configs
      let rawConfigToCopy = "";
      const CONVERTER_URL = "https://api.foolvpn.me/convert";

      function toggleOutputWindow() {
        const outputWindow = document.getElementById("output-window");
        outputWindow.classList.toggle("hidden");
      }

      function showFormatSelection(text) {
        rawConfigToCopy = text;
        toggleOutputWindow();
      }

      function copyToClipboardAsRaw() {
        navigator.clipboard
          .writeText(rawConfigToCopy)
          .then(() => {
            showNotification("Berhasil!", "Konfigurasi RAW berhasil disalin.");
          })
          .catch((err) => {
            console.error("Could not copy text: ", err);
            showNotification("Gagal!", "Tidak dapat menyalin teks.", true);
          });
        toggleOutputWindow();
      }

      async function copyToClipboardAsTarget(target) {
        showNotification(
          "Processing...",
          `Generating ${target.toUpperCase()} config...`
        );
        toggleOutputWindow();

        try {
          const response = await fetch(CONVERTER_URL, {
            method: "POST",
            body: JSON.stringify({
              url: rawConfigToCopy,
              format: target,
              template: "cf",
            }),
          });

          if (!response.ok) {
            throw new Error(`Converter API failed: ${response.statusText}`);
          }

          const convertedConfig = await response.text();
          navigator.clipboard.writeText(convertedConfig).then(() => {
            showNotification(
              "Berhasil!",
              `Konfigurasi ${target.toUpperCase()} berhasil disalin.`
            );
          });
        } catch (error) {
          console.error(`Failed to convert to ${target}:`, error);
          showNotification(
            "Gagal!",
            `Konversi ke ${target.toUpperCase()} gagal.`,
            true
          );
        }
      }

      function showNotification(title, message, isError = false) {
        const badge = document.getElementById("notification-badge");
        document.getElementById("notification-title").textContent = title;
        document.getElementById("notification-message").textContent = message;

        const titleElement = document.getElementById("notification-title");
        titleElement.className = `text-md font-bold ${
          isError ? "text-red-500" : "text-blue-500"
        }`;

        badge.classList.remove("opacity-0");
        setTimeout(() => {
          badge.classList.add("opacity-0");
        }, 3000);
      }

      async function loadGeoIP() {
        try {
          const response = await fetch(`${WORKER_URL}/api/v1/myip`);
          const data = await response.json();
          document.getElementById("ip-value").textContent = data.ip || "N/A";
          document.getElementById("isp-value").textContent =
            data.asOrganization || "N/A";
        } catch (error) {
          console.error("Failed to load GeoIP:", error);
          document.getElementById("ip-value").textContent = "Error";
          document.getElementById("isp-value").textContent = "Error";
        }
      }

      function checkAllProxiesHealth() {
        const cards = document.querySelectorAll('[id^="ping-"]');
        cards.forEach((pingElement) => {
          const target = pingElement.dataset.target;
          if (target) {
            pingElement.textContent = "Checking...";
            fetch(`${WORKER_URL}/check?target=${target}`)
              .then((res) => res.json())
              .then((jsonResp) => {
                pingElement.classList.remove(
                  "text-gray-400",
                  "dark:text-gray-500",
                  "text-red-500",
                  "dark:text-red-500"
                );
                if (jsonResp.proxyip === true) {
                  pingElement.textContent = `Active ${jsonResp.delay} ms (${jsonResp.colo})`;
                  pingElement.classList.add(
                    "text-green-500",
                    "dark:text-green-400"
                  );
                } else {
                  pingElement.textContent = "Inactive";
                  pingElement.classList.add(
                    "text-red-500",
                    "dark:text-red-500"
                  );
                }
              })
              .catch(() => {
                pingElement.textContent = "Check Failed!";
                pingElement.classList.add("text-red-500", "dark:text-red-500");
              });
          }
        });
      }

      let isDomainListFetched = false;

      function toggleWildcardsWindow() {
        const wildcardsWindow = document.getElementById("wildcards-window");
        wildcardsWindow.classList.toggle("hidden");
        if (
          !wildcardsWindow.classList.contains("hidden") &&
          !isDomainListFetched
        ) {
          getDomainList();
        }
      }

      async function getDomainList() {
        const domainListContainer =
          document.getElementById("container-domains");
        domainListContainer.innerHTML =
          '<div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"></div>';

        try {
          const response = await fetch(`${WORKER_URL}/api/v1/domains/get`);
          const data = await response.json();
          domainListContainer.innerHTML = "";

          if (data.success && data.result.length > 0) {
            data.result.forEach((domain) => {
              const p = document.createElement("p");
              p.className = "w-full bg-gray-700 p-2 rounded-md text-sm";
              p.textContent = domain;
              domainListContainer.appendChild(p);
            });
          } else {
            domainListContainer.textContent =
              "No domains found or API not configured.";
          }
          isDomainListFetched = true;
        } catch (error) {
          console.error("Failed to get domain list:", error);
          domainListContainer.textContent = "Error fetching domain list.";
        }
      }

      async function registerDomain() {
        const domainInput = document.getElementById("new-domain-input");
        const domain = domainInput.value.trim();

        if (!domain) {
          showNotification("Error", "Domain name cannot be empty.", true);
          return;
        }

        showNotification("Processing...", `Registering ${domain}...`);
        try {
          const response = await fetch(
            `${WORKER_URL}/api/v1/domains/put?domain=${domain}`
          );
          const data = await response.json();

          if (data.success) {
            showNotification("Success!", data.message);
            domainInput.value = "";
            isDomainListFetched = false;
            getDomainList();
          } else {
            showNotification("Failed!", data.message, true);
          }
        } catch (error) {
          console.error("Failed to register domain:", error);
          showNotification("Error", "An unexpected error occurred.", true);
        }
      }

      function toggleDarkMode() {
        document.getElementById("html").classList.toggle("dark");
      }

      function updateTime() {
        document.getElementById("time-info-value").textContent =
          new Date().toLocaleTimeString("en-GB");
      }

      window.onload = async () => {
        const loadingScreen = document.getElementById("loading-screen");
        const mainContainer = document.getElementById("main-container");

        try {
          await main();
          applyRandomHeaderColors();
        } catch (error) {
          console.error("Initialization failed:", error);
        } finally {
          loadingScreen.classList.add("opacity-0");
          mainContainer.classList.remove("opacity-0");
          setTimeout(() => {
            loadingScreen.remove();
          }, 500);
        }
      };
    </script>
  </body>
</html>
